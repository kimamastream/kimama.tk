var animedata = {
	"assassinationclassrooms01": {
		"animetitle": "Watch Assassination CLassroom S01",
		"animevidlink": '<iframe src="https://gogoplay1.com/streaming.php?id=MTE3MTgz" allowfullscreen="true" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" id="link-1"></iframe>',
		"animedetailsh2": "Assassina-tion Classroom",
		"animedetailsh4": "Season 1",
		"animedetails": `Contrary to popular belief, Lorem Ipsum is not simply random text. It has roots in a piece of classical Latin literature from 45 BC, making it over 2000 years old. Richard McClintock, a Latin professor at Hampden-Sydney College in Virginia, looked up one of the more obscure Latin words, consectetur, from a Lorem Ipsum passage, and going through the cites of the word in classical literature, discovered the undoubtable source. Lorem Ipsum comes from sections 1.10.32 and 1.10.33 of "de Finibus Bonorum et Malorum" (The Extremes of Good and Evil) by Cicero, written in 45 BC. This book is a treatise on the theory of ethics, very popular during the Renaissance. The first line of Lorem Ipsum, "Lorem ipsum dolor sit amet..", comes from a line in section 1.10.32.The standard chunk of Lorem Ipsum used since the 1500s is reproduced below for those interested. Sections 1.10.32 and 1.10.33 from "de Finibus Bonorum et Malorum" by Cicero are also reproduced in their exact original form, accompanied by English versions from the 1914 translation by H. Rackham.`,
		"animeimg": 'https://drive.google.com/uc?export=view&id=1djuEnp1qVAAD3F3Wb2H_WzaOk4oytHua',
		"alterimg": 'https://cdnimg.xyz/cover/one-punch-man-dub.png',
		"published": 2015,
		"open": "https://drive.google.com/file/d/1Yymy4l_tW43tT1qR7AT7V8QGHXQQW4H8/view?usp=sharing",
		"end": "https://drive.google.com/file/d/1tHzTTyV1ouufI2fb-odX7t1QS9qqkqRi/view?usp=sharing",
		"gogo": "https://gogoplay1.com/videos/one-punch-man-dub-episode-",
		"episodenumber": 12,
		"animerelated": ["assassinationclassrooms02","assassinationclassrooms01"]
  	},

  	"assassinationclassrooms02": {
		"animetitle": "Watch Assassination Classroom S02",
		"animevidlink": '<iframe  src="https://drive.google.com/file/d/1uJooIA3pvHee5GfICiYwZNSRxnlCzzxC/preview" allowfullscreen="true" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" id="link-1"></iframe>',
		"animedetailsh2": "Assassina-tion Classroom",
		"animedetailsh4": "Season 2",
		"animedetails": `The students return as school is back in session for the second semester. Following their exploits on the island during summer vacation, Class 3-E continues to sharpen their blades with their sights set on their teacher, the slippery Koro-sensei. They have more to worry about than just their teacher, however, as enemy assassins, both old and new, are out for the increased bounty on the octopus' head. Moreover, their rivals in Class A, as well as Kunugigaoka Junior High's fearsome principal, stand to block Class E from achieving academic excellence. With all of these obstacles opposing them, the group must continue to work together in order to overcome their foes and accomplish their goal of successfully assassinating their teacher.`,
		"animeimg": 'https://drive.google.com/uc?export=view&id=1kMf26PmUeCWD4ete5nKyYS2CU3NSq1k9',
		"alterimg": 'https://cdnimg.xyz/cover/one-punch-man-dub.png',
		"published": 2015,
		"open": "https://drive.google.com/file/d/1Yymy4l_tW43tT1qR7AT7V8QGHXQQW4H8/view?usp=sharing",
		"end": "https://drive.google.com/file/d/1tHzTTyV1ouufI2fb-odX7t1QS9qqkqRi/view?usp=sharing",
		"gogo": "https://gogoplay1.com/videos/one-punch-man-2nd-season-dub-episode-1",
		"episodenumber": 12,
		"animerelated": ["assassinationclassrooms02","assassinationclassrooms01"]
   	},

   	"attackontitans01": {
        "animetitle": "Watch Attack On Titan Season 1",
        "animevidlink": '<iframe  src="https://drive.google.com/file/d/14uTyNlAuwAOM4KErhr56cnkI3jxYoBGd/preview" allowfullscreen="true" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" id="link-1"></iframe>',
        "animedetailsh2": "Attack on Titan",
        "animedetailsh4": "Season 1",
        "animedetails": `Centuries ago, mankind was slaughtered to near extinction by monstrous humanoid creatures called titans, forcing humans to hide in fear behind enormous concentric walls. What makes these giants truly terrifying is that their taste for human flesh is not born out of hunger but what appears to be out of pleasure. To ensure their survival, the remnants of humanity began living within defensive barriers, resulting in one hundred years without a single titan encounter. However, that fragile calm is soon shattered when a colossal titan manages to breach the supposedly impregnable outer wall, reigniting the fight for survival against the man-eating abominations. After witnessing a horrific personal loss at the hands of the invading creatures, Eren Yeager dedicates his life to their eradication by enlisting into the Survey Corps, an elite military unit that combats the merciless humanoids outside the protection of the walls. Based on Hajime Isayama's award-winning manga, Shingeki no Kyojin follows Eren, along with his adopted sister Mikasa Ackerman and his childhood friend Armin Arlert, as they join the brutal war against the titans and race to discover a way of defeating them before the last walls are breached.`,
        "animeimg": 'https://drive.google.com/uc?export=view&id=1GI_EeMIZHTxFP2B99Y5oiTlpl1J2mIa-',
		"alterimg": 'https://cdnimg.xyz/cover/one-punch-man-dub.png',
		"published": 2015,
		"open": "https://drive.google.com/file/d/1Yymy4l_tW43tT1qR7AT7V8QGHXQQW4H8/view?usp=sharing",
		"end": "https://drive.google.com/file/d/1tHzTTyV1ouufI2fb-odX7t1QS9qqkqRi/view?usp=sharing",
		"gogo": "https://gogoplay1.com/videos/shingeki-no-kyojin-dub-episode-1",
        "episodenumber": 12,
		"animerelated": ["assassinationclassrooms02","assassinationclassrooms01"]                
        },

  	"deathnote": {
			"animetitle": "Watch Death Note",
			"animevidlink": '<iframe  src="https://drive.google.com/file/d/1pXQHLrZ9CsW8BKJBmD2L1fSfPYgiK1Fz/preview" allowfullscreen="true" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" id="link-1"></iframe>',
			"animedetailsh2": "Death Note",
			"animedetailsh4": "Completed",
			"animedetails": `Light Yagami (Tatsuya Fujiwara) is a normal, undistinguished college student -- that is, until he discovers an odd notebook lying on the ground. He soon discovers that the notebook has magic powers: If someone's name is written on it while the writer imagines that person's face, he or she will die.With the Death Note in hand, he goes on a personal crusade and moves to kill all evil in the world and become God. He does this all in his new name, Kira, and declares himself the law and justice of the world. Intoxicated with his new godlike power, Light kills those he deems unworthy of life. But a mysterious detective known only as L (Ken'ichi Matsuyama) becomes determined to put a stop to his reign.`,
			"animeimg": 'https://drive.google.com/uc?export=view&id=1GOQceqgfS18P0H8Q7BERc39R_Tq0W6IS',
			"alterimg": 'https://cdnimg.xyz/cover/one-punch-man-dub.png',
			"published": 2015,
			"open": "https://drive.google.com/file/d/1Yymy4l_tW43tT1qR7AT7V8QGHXQQW4H8/view?usp=sharing",
			"end": "https://drive.google.com/file/d/1tHzTTyV1ouufI2fb-odX7t1QS9qqkqRi/view?usp=sharing",
			"gogo": "https://gogoplay1.com/videos/death-note-dub-episode-1",
			"episodenumber": 12,
			"animerelated": []
   	}
   	
}

var current_episode = 0;
var top4trend = ["assassinationclassrooms01","assassinationclassrooms02","attackontitans01","deathnote"]
var episodelinks = [];

function getParameter(parameter_name) {
    let parameters = new URLSearchParams( window.location.search );
    return parameters.get( parameter_name );
}

function generateEpisodeFromId(parameter_id) {
	var unit = animedata[getParameter(parameter_id)];

	for (const [key, value] of Object.entries(unit)) {
		if (key == "episodelinks") continue;
		else if ( key == "animeimg" ) continue;
		$("#" + key).html(value);
	}

	collect_episode(unit);
	addEpisodeHtml(unit);
	addEpisodeTitle(unit.animetitle, 0);
	addButtonListener(unit);
	RelatedAnime(unit);
	top4Trending(unit);
	openingEnding(unit);
}

function addAnimeList() {
	var makeList = [];
	for (const [key, unit] of Object.entries(animedata)) {
		makeList.push(`
			<li><a href="../../all/anime/sub_anime.html?anime=${key}">
			  <img onerror="this.src='${unit.alterimg}';" src="${unit.animeimg}" alt="${unit.animedetailsh2}" />
			  <h5>${unit.animedetailsh2}</h5>
			  <h6>${unit.animedetailsh4}</h6></a>
			</li>
		`);
	}

	var animelistHtml = makeList.join(" ");
	$("#animelist").html(animelistHtml);
}

function collect_episode(unit) {
	var episode_urls = [];

	for (var i = 1; i < unit.episodenumber + 1; i++) {
		episode_urls.push(unit.gogo + i)
	}
		
	for ( let i of episode_urls ) {
		$.get(i, function(cllect_iframes) {
			var page_source = document.createElement("html");
			page_source.innerHTML = cllect_iframes;
            
			var links = page_source.getElementsByTagName("iframe");

			episodelinks.push("https:" + links[0].getAttribute("src"));
		});
	}

}

function addEpisodeHtml(unit) {
	var makeEpisodeList = []; 
	for (var i = 1; i <= unit.episodenumber; i++) {
		makeEpisodeList.push(`<li><a href="#" class="btn${i}" data-episode="${i}">${i}</a></li>`);
	}
	var episodeHtml = makeEpisodeList.join(" ");
	$("#animepisode").html(episodeHtml);
	$("#animeimg").html(`<img onerror="this.src='${unit.alterimg}';" src="${unit.animeimg}" alt="${unit.animedetailsh2}" />`);
}

function addButtonListener(unit) {
	document.querySelector('.nextbtn').addEventListener('click', () => generateEpisode(unit, current_episode + 1) );
	document.querySelector('.prevbtn').addEventListener('click', () => generateEpisode(unit, current_episode - 1) );

	for (var i = 1; i <= unit.episodenumber; i++) {
		var btni = document.querySelector('.btn' + i);
		btni.addEventListener('click', (e) => {
			var episode = e.target.getAttribute("data-episode");
			generateEpisode(unit, parseInt(episode) - 1);
		});
	}
}


function generateEpisode(unit, i) {
	if (episodelinks[i] === undefined) {
		return;
	}

	current_episode = i;
	$("#link-1").attr("src", episodelinks[i]);
	addEpisodeTitle(unit.animetitle, i);
}

function addEpisodeTitle(unit_animetitle, i) {
	// todo: add '0' before 1-9 episode
	$("#animeepisodetitle").html(unit_animetitle.replace("Watch","") + "  Episode " + (i + 1));
}

function openingEnding(unit) {
	$("#opening").attr("href", unit.open);
	$("#ending").attr("href", unit.end);
}
 
function top4Trending() {
	var makeTop4 = [];
	makeTop4.push(`
		<h2>TOP-4 Anime</h2>
		<ul id="suffletrend">
	`);
	top4trend.forEach(key => {
		ii = animedata[key];
		makeTop4.push(`
			<li>
				<img onerror="this.src='${ii.alterimg}';" src="${ii.animeimg}" alt="${ii.animedetailsh2}" /> <br>
				<a href="?anime=${key}">
				<h3>${ii.animedetailsh2}</h3>
				</a>
				<h5>${ii.animedetailsh4}</h5>
				<p>Published on ${ii.published}</p>
			</li>
	  
		`);	
	})
	makeTop4.push(` </ul>`);

	var animeTop4Html = makeTop4.join(" ");
	$("#anime-top4").html(animeTop4Html);
}

function RelatedAnime(unit) {
	unit_animerelated = unit.animerelated;
	var makeRelated = [];

	if (unit_animerelated.length != 0) {

		makeRelated.push(`
		<div class="related"><h2>Related Anime</h2>
		<ul>
		`);
		unit_animerelated.forEach(key => {
			relation = animedata[key];
			makeRelated.push(`
				<li>
					<img onerror="this.src='${relation.alterimg}';" src="${relation.animeimg}" alt="${relation.animedetailsh2}" /> <br>
					<a href="?anime=${key}">
					<h3>${relation.animedetailsh2}</h3>
					</a>
					<h5>${relation.animedetailsh4}</h5>
					<p>Ep-${unit.episodenumber} | ${unit.episodenumber} ${relation.published}</p>
				</li>

			`);
		})
		makeRelated.push(`
			</ul>
			</div>
		`);

	} else {makeRelated.push(` `)}

	var animeRelatedHtml = makeRelated.join(" ");
	$("#relatedanime").html(animeRelatedHtml);
} 